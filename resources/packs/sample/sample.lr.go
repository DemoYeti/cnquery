// Code generated by resources. DO NOT EDIT.
package sample

import (
	"errors"
	"fmt"
	"time"

	"go.mondoo.com/cnquery/resources"
	"github.com/rs/zerolog/log"
)

// Init all resources into the registry
func Init(registry *resources.Registry) {
	registry.AddFactory("sample.project", newSampleProject)
	registry.AddFactory("sample.project.computeService", newSampleProjectComputeService)
	registry.AddFactory("sample.project.compute.instance", newSampleProjectComputeInstance)
}

// SampleProject resource interface
type SampleProject interface {
	MqlResource() (*resources.Resource)
	MqlCompute(string) error
	Field(string) (interface{}, error)
	Register(string) error
	Validate() error
	Id() (string, error)
	Compute() (SampleProjectComputeService, error)
}

// mqlSampleProject for the sample.project resource
type mqlSampleProject struct {
	*resources.Resource
}

// MqlResource to retrieve the underlying resource info
func (s *mqlSampleProject) MqlResource() *resources.Resource {
	return s.Resource
}

// create a new instance of the sample.project resource
func newSampleProject(runtime *resources.Runtime, args *resources.Args) (interface{}, error) {
	// User hooks
	var err error
	res := mqlSampleProject{runtime.NewResource("sample.project")}
	var existing SampleProject
	args, existing, err = res.init(args)
	if err != nil {
		return nil, err
	}
	if existing != nil {
		return existing, nil
	}

	// assign all named fields
	var id string

	now := time.Now().Unix()
	for name, val := range *args {
		if val == nil {
			res.Cache.Store(name, &resources.CacheEntry{Data: val, Valid: true, Timestamp: now})
			continue
		}

		switch name {
		case "id":
			if _, ok := val.(string); !ok {
				return nil, errors.New("Failed to initialize \"sample.project\", its \"id\" argument has the wrong type (expected type \"string\")")
			}
		case "compute":
			if _, ok := val.(SampleProjectComputeService); !ok {
				return nil, errors.New("Failed to initialize \"sample.project\", its \"compute\" argument has the wrong type (expected type \"SampleProjectComputeService\")")
			}
		case "__id":
			idVal, ok := val.(string)
			if !ok {
				return nil, errors.New("Failed to initialize \"sample.project\", its \"__id\" argument has the wrong type (expected type \"string\")")
			}
			id = idVal
		default:
			return nil, errors.New("Initialized sample.project with unknown argument " + name)
		}
		res.Cache.Store(name, &resources.CacheEntry{Data: val, Valid: true, Timestamp: now})
	}

	// Get the ID
	if id == "" {
		res.Resource.Id, err = res.id()
		if err != nil {
			return nil, err
		}
	} else {
		res.Resource.Id = id
	}

	return &res, nil
}

func (s *mqlSampleProject) Validate() error {
	// required arguments
	// no required fields found

	return nil
}

// Register accessor autogenerated
func (s *mqlSampleProject) Register(name string) error {
	log.Trace().Str("field", name).Msg("[sample.project].Register")
	switch name {
	case "id":
		return nil
	case "compute":
		return nil
	default:
		return errors.New("Cannot find field '" + name + "' in \"sample.project\" resource")
	}
}

// Field accessor autogenerated
func (s *mqlSampleProject) Field(name string) (interface{}, error) {
	log.Trace().Str("field", name).Msg("[sample.project].Field")
	switch name {
	case "id":
		return s.Id()
	case "compute":
		return s.Compute()
	default:
		return nil, fmt.Errorf("Cannot find field '" + name + "' in \"sample.project\" resource")
	}
}

// Id accessor autogenerated
func (s *mqlSampleProject) Id() (string, error) {
	res, ok := s.Cache.Load("id")
	if !ok || !res.Valid {
		if err := s.ComputeId(); err != nil {
			return "", err
		}
		res, ok = s.Cache.Load("id")
		if !ok {
			return "", errors.New("\"sample.project\" calculated \"id\" but didn't find its value in cache.")
		}
		s.MotorRuntime.Trigger(s, "id")
	}
	if res.Error != nil {
		return "", res.Error
	}
	tres, ok := res.Data.(string)
	if !ok {
		return "", fmt.Errorf("\"sample.project\" failed to cast field \"id\" to the right type (string): %#v", res)
	}
	return tres, nil
}

// Compute accessor autogenerated
func (s *mqlSampleProject) Compute() (SampleProjectComputeService, error) {
	res, ok := s.Cache.Load("compute")
	if !ok || !res.Valid {
		if err := s.ComputeCompute(); err != nil {
			return nil, err
		}
		res, ok = s.Cache.Load("compute")
		if !ok {
			return nil, errors.New("\"sample.project\" calculated \"compute\" but didn't find its value in cache.")
		}
		s.MotorRuntime.Trigger(s, "compute")
	}
	if res.Error != nil {
		return nil, res.Error
	}
	tres, ok := res.Data.(SampleProjectComputeService)
	if !ok {
		return nil, fmt.Errorf("\"sample.project\" failed to cast field \"compute\" to the right type (SampleProjectComputeService): %#v", res)
	}
	return tres, nil
}

// Compute accessor autogenerated
func (s *mqlSampleProject) MqlCompute(name string) error {
	log.Trace().Str("field", name).Msg("[sample.project].MqlCompute")
	switch name {
	case "id":
		return s.ComputeId()
	case "compute":
		return s.ComputeCompute()
	default:
		return errors.New("Cannot find field '" + name + "' in \"sample.project\" resource")
	}
}

// ComputeId computer autogenerated
func (s *mqlSampleProject) ComputeId() error {
	var err error
	if _, ok := s.Cache.Load("id"); ok {
		return nil
	}
	vres, err := s.GetId()
	if _, ok := err.(resources.NotReadyError); ok {
		return err
	}
	s.Cache.Store("id", &resources.CacheEntry{Data: vres, Valid: true, Error: err, Timestamp: time.Now().Unix()})
	return nil
}

// ComputeCompute computer autogenerated
func (s *mqlSampleProject) ComputeCompute() error {
	var err error
	if _, ok := s.Cache.Load("compute"); ok {
		return nil
	}
	vres, err := s.GetCompute()
	if _, ok := err.(resources.NotReadyError); ok {
		return err
	}
	s.Cache.Store("compute", &resources.CacheEntry{Data: vres, Valid: true, Error: err, Timestamp: time.Now().Unix()})
	return nil
}

// SampleProjectComputeService resource interface
type SampleProjectComputeService interface {
	MqlResource() (*resources.Resource)
	MqlCompute(string) error
	Field(string) (interface{}, error)
	Register(string) error
	Validate() error
	ProjectId() (string, error)
	Instances() ([]interface{}, error)
}

// mqlSampleProjectComputeService for the sample.project.computeService resource
type mqlSampleProjectComputeService struct {
	*resources.Resource
}

// MqlResource to retrieve the underlying resource info
func (s *mqlSampleProjectComputeService) MqlResource() *resources.Resource {
	return s.Resource
}

// create a new instance of the sample.project.computeService resource
func newSampleProjectComputeService(runtime *resources.Runtime, args *resources.Args) (interface{}, error) {
	// User hooks
	var err error
	res := mqlSampleProjectComputeService{runtime.NewResource("sample.project.computeService")}
	// assign all named fields
	var id string

	now := time.Now().Unix()
	for name, val := range *args {
		if val == nil {
			res.Cache.Store(name, &resources.CacheEntry{Data: val, Valid: true, Timestamp: now})
			continue
		}

		switch name {
		case "projectId":
			if _, ok := val.(string); !ok {
				return nil, errors.New("Failed to initialize \"sample.project.computeService\", its \"projectId\" argument has the wrong type (expected type \"string\")")
			}
		case "instances":
			if _, ok := val.([]interface{}); !ok {
				return nil, errors.New("Failed to initialize \"sample.project.computeService\", its \"instances\" argument has the wrong type (expected type \"[]interface{}\")")
			}
		case "__id":
			idVal, ok := val.(string)
			if !ok {
				return nil, errors.New("Failed to initialize \"sample.project.computeService\", its \"__id\" argument has the wrong type (expected type \"string\")")
			}
			id = idVal
		default:
			return nil, errors.New("Initialized sample.project.computeService with unknown argument " + name)
		}
		res.Cache.Store(name, &resources.CacheEntry{Data: val, Valid: true, Timestamp: now})
	}

	// Get the ID
	if id == "" {
		res.Resource.Id, err = res.id()
		if err != nil {
			return nil, err
		}
	} else {
		res.Resource.Id = id
	}

	return &res, nil
}

func (s *mqlSampleProjectComputeService) Validate() error {
	// required arguments
	if _, ok := s.Cache.Load("projectId"); !ok {
		return errors.New("Initialized \"sample.project.computeService\" resource without a \"projectId\". This field is required.")
	}

	return nil
}

// Register accessor autogenerated
func (s *mqlSampleProjectComputeService) Register(name string) error {
	log.Trace().Str("field", name).Msg("[sample.project.computeService].Register")
	switch name {
	case "projectId":
		return nil
	case "instances":
		return nil
	default:
		return errors.New("Cannot find field '" + name + "' in \"sample.project.computeService\" resource")
	}
}

// Field accessor autogenerated
func (s *mqlSampleProjectComputeService) Field(name string) (interface{}, error) {
	log.Trace().Str("field", name).Msg("[sample.project.computeService].Field")
	switch name {
	case "projectId":
		return s.ProjectId()
	case "instances":
		return s.Instances()
	default:
		return nil, fmt.Errorf("Cannot find field '" + name + "' in \"sample.project.computeService\" resource")
	}
}

// ProjectId accessor autogenerated
func (s *mqlSampleProjectComputeService) ProjectId() (string, error) {
	res, ok := s.Cache.Load("projectId")
	if !ok || !res.Valid {
		return "", errors.New("\"sample.project.computeService\" failed: no value provided for static field \"projectId\"")
	}
	if res.Error != nil {
		return "", res.Error
	}
	tres, ok := res.Data.(string)
	if !ok {
		return "", fmt.Errorf("\"sample.project.computeService\" failed to cast field \"projectId\" to the right type (string): %#v", res)
	}
	return tres, nil
}

// Instances accessor autogenerated
func (s *mqlSampleProjectComputeService) Instances() ([]interface{}, error) {
	res, ok := s.Cache.Load("instances")
	if !ok || !res.Valid {
		if err := s.ComputeInstances(); err != nil {
			return nil, err
		}
		res, ok = s.Cache.Load("instances")
		if !ok {
			return nil, errors.New("\"sample.project.computeService\" calculated \"instances\" but didn't find its value in cache.")
		}
		s.MotorRuntime.Trigger(s, "instances")
	}
	if res.Error != nil {
		return nil, res.Error
	}
	tres, ok := res.Data.([]interface{})
	if !ok {
		return nil, fmt.Errorf("\"sample.project.computeService\" failed to cast field \"instances\" to the right type ([]interface{}): %#v", res)
	}
	return tres, nil
}

// Compute accessor autogenerated
func (s *mqlSampleProjectComputeService) MqlCompute(name string) error {
	log.Trace().Str("field", name).Msg("[sample.project.computeService].MqlCompute")
	switch name {
	case "projectId":
		return nil
	case "instances":
		return s.ComputeInstances()
	default:
		return errors.New("Cannot find field '" + name + "' in \"sample.project.computeService\" resource")
	}
}

// ComputeInstances computer autogenerated
func (s *mqlSampleProjectComputeService) ComputeInstances() error {
	var err error
	if _, ok := s.Cache.Load("instances"); ok {
		return nil
	}
	vres, err := s.GetInstances()
	if _, ok := err.(resources.NotReadyError); ok {
		return err
	}
	s.Cache.Store("instances", &resources.CacheEntry{Data: vres, Valid: true, Error: err, Timestamp: time.Now().Unix()})
	return nil
}

// SampleProjectComputeInstance resource interface
type SampleProjectComputeInstance interface {
	MqlResource() (*resources.Resource)
	MqlCompute(string) error
	Field(string) (interface{}, error)
	Register(string) error
	Validate() error
	Id() (string, error)
	Name() (string, error)
}

// mqlSampleProjectComputeInstance for the sample.project.compute.instance resource
type mqlSampleProjectComputeInstance struct {
	*resources.Resource
}

// MqlResource to retrieve the underlying resource info
func (s *mqlSampleProjectComputeInstance) MqlResource() *resources.Resource {
	return s.Resource
}

// create a new instance of the sample.project.compute.instance resource
func newSampleProjectComputeInstance(runtime *resources.Runtime, args *resources.Args) (interface{}, error) {
	// User hooks
	var err error
	res := mqlSampleProjectComputeInstance{runtime.NewResource("sample.project.compute.instance")}
	// assign all named fields
	var id string

	now := time.Now().Unix()
	for name, val := range *args {
		if val == nil {
			res.Cache.Store(name, &resources.CacheEntry{Data: val, Valid: true, Timestamp: now})
			continue
		}

		switch name {
		case "id":
			if _, ok := val.(string); !ok {
				return nil, errors.New("Failed to initialize \"sample.project.compute.instance\", its \"id\" argument has the wrong type (expected type \"string\")")
			}
		case "name":
			if _, ok := val.(string); !ok {
				return nil, errors.New("Failed to initialize \"sample.project.compute.instance\", its \"name\" argument has the wrong type (expected type \"string\")")
			}
		case "__id":
			idVal, ok := val.(string)
			if !ok {
				return nil, errors.New("Failed to initialize \"sample.project.compute.instance\", its \"__id\" argument has the wrong type (expected type \"string\")")
			}
			id = idVal
		default:
			return nil, errors.New("Initialized sample.project.compute.instance with unknown argument " + name)
		}
		res.Cache.Store(name, &resources.CacheEntry{Data: val, Valid: true, Timestamp: now})
	}

	// Get the ID
	if id == "" {
		res.Resource.Id, err = res.id()
		if err != nil {
			return nil, err
		}
	} else {
		res.Resource.Id = id
	}

	return &res, nil
}

func (s *mqlSampleProjectComputeInstance) Validate() error {
	// required arguments
	if _, ok := s.Cache.Load("id"); !ok {
		return errors.New("Initialized \"sample.project.compute.instance\" resource without a \"id\". This field is required.")
	}
	if _, ok := s.Cache.Load("name"); !ok {
		return errors.New("Initialized \"sample.project.compute.instance\" resource without a \"name\". This field is required.")
	}

	return nil
}

// Register accessor autogenerated
func (s *mqlSampleProjectComputeInstance) Register(name string) error {
	log.Trace().Str("field", name).Msg("[sample.project.compute.instance].Register")
	switch name {
	case "id":
		return nil
	case "name":
		return nil
	default:
		return errors.New("Cannot find field '" + name + "' in \"sample.project.compute.instance\" resource")
	}
}

// Field accessor autogenerated
func (s *mqlSampleProjectComputeInstance) Field(name string) (interface{}, error) {
	log.Trace().Str("field", name).Msg("[sample.project.compute.instance].Field")
	switch name {
	case "id":
		return s.Id()
	case "name":
		return s.Name()
	default:
		return nil, fmt.Errorf("Cannot find field '" + name + "' in \"sample.project.compute.instance\" resource")
	}
}

// Id accessor autogenerated
func (s *mqlSampleProjectComputeInstance) Id() (string, error) {
	res, ok := s.Cache.Load("id")
	if !ok || !res.Valid {
		return "", errors.New("\"sample.project.compute.instance\" failed: no value provided for static field \"id\"")
	}
	if res.Error != nil {
		return "", res.Error
	}
	tres, ok := res.Data.(string)
	if !ok {
		return "", fmt.Errorf("\"sample.project.compute.instance\" failed to cast field \"id\" to the right type (string): %#v", res)
	}
	return tres, nil
}

// Name accessor autogenerated
func (s *mqlSampleProjectComputeInstance) Name() (string, error) {
	res, ok := s.Cache.Load("name")
	if !ok || !res.Valid {
		return "", errors.New("\"sample.project.compute.instance\" failed: no value provided for static field \"name\"")
	}
	if res.Error != nil {
		return "", res.Error
	}
	tres, ok := res.Data.(string)
	if !ok {
		return "", fmt.Errorf("\"sample.project.compute.instance\" failed to cast field \"name\" to the right type (string): %#v", res)
	}
	return tres, nil
}

// Compute accessor autogenerated
func (s *mqlSampleProjectComputeInstance) MqlCompute(name string) error {
	log.Trace().Str("field", name).Msg("[sample.project.compute.instance].MqlCompute")
	switch name {
	case "id":
		return nil
	case "name":
		return nil
	default:
		return errors.New("Cannot find field '" + name + "' in \"sample.project.compute.instance\" resource")
	}
}

